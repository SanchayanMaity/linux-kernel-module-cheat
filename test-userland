#!/usr/bin/env python3

import os
import sys

import common

class Main(common.LkmcCliFunction):
    def __init__(self):
        super().__init__(
            defaults={
                'print_time': False,
            },
            description='''\
Boot Linux and run all non-interactive userland tests, including those
for kernel modules.

Detect failure based on the magic terminal failure string.
'''
        )

    def timed_main(self):
        run = self.import_path_main('run')
        run_args = self.get_common_args()
        run_args['eval_after'] = '/test_all.sh;/poweroff.out'
        run(**run_args)

if __name__ == '__main__':
    Main().cli()
